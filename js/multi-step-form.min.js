!function(a){"use strict";function b(b,c){b.step(a(c).attr("rel").substring(6)-1)}function c(b,c){this.$el=a(b),this.id=b.id,this.buttonText=c.textNext||"Next",this._getElements(),this._bindEvents(),this._updateDom(),this._initValidator(),this.step(0)}var d;a.extend(c.prototype,{_getElements:function(){this.steps=this.$el.find('[id*="fstep_"]'),this.stepInputs=this.steps.map(function(b,c){return a(c).find("input,select,textarea")}),this.links=a('[rel_form="'+this.id+'"]'),d=d||a("body")},_bindEvents:function(){d.on("click",'[rel][rel_form="'+this.id+'"]',a.proxy(function(a){b(this,a.target)},this)),d.on("keydown",'[rel][rel_form="'+this.id+'"]',a.proxy(function(a){13===a.keyCode&&b(this,a.target)},this)),this.$el.on("keydown","input,select,textarea",a.proxy(function(a){return 13===a.keyCode?(a.preventDefault(),void this.nextButton.trigger("click")):9===a.keyCode?void(this.stepInputs.get(this.step).last().get(0)===a.target&&(a.preventDefault(),this.nextButton.focus())):void 0},this))},_updateDom:function(){this.steps.wrapAll('<div class="container_steps" style="position:relative" />').append('<div style="clear:both"></div>'),this.steps.wrap('<div class="container_form" />'),this.nextButton=a('<span class="fnext myButton" rel_form="'+this.id+'" tabindex="0">'+this.buttonText+"</span>").insertAfter(this.$el)},_initValidator:function(){a.fn.validate&&(this.validator=this.$el.validate({messages:{email:"The email is invalid"}}),this.$el.on("changestep",a.proxy(function(b){var c=this.stepInputs.slice(0,b.to),d=-1;c.each(function(b,c){return c.each(function(c,e){return a(e).valid()?void 0:(d=b,!1)}),d>-1?!1:void 0}),d>-1&&(b.to=d),b.to===this.steps.length&&(b.preventDefault(),this.$el.submit())},this)))},step:function(b){var c,d=this.currentStep,e=this.steps.length;return a.isNumeric(b)&&b>=0&&e>=b?(d!==b&&(c=jQuery.Event("changestep",{from:d,to:b}),this.$el.trigger(c),c.to===d||c.isDefaultPrevented()||(this.steps.css({position:"absolute",left:-9999}).eq(c.to).css({position:"",left:""}),this.nextButton.attr("rel","fstep_"+(c.to+2)),this.links.eq(c.from).removeClass("step_highlight"),this.links.eq(c.to).addClass("step_highlight"),this.stepInputs.get(c.to).first().focus(),this.currentStep=c.to)),this):d},error:function(a,b){var c={};c[a.name||a.attr("name")]=b,this.validator.showErrors(c)},mainButton:function(){return this.nextButton}}),a.fn.multiStepForm=function(b){var d;return"string"!=typeof b?(this.each(function(a,d){var e=new c(d,b||{});e.$el.data("MultiStepForm",e)}),this):(d=this.data("MultiStepForm"),d&&d instanceof c?"_"!==b.charAt(0)&&d[b]&&a.isFunction(d[b])?d[b].apply(d,Array.prototype.slice.call(arguments,1)):a.error("Method "+b+" does not exist on MultiStepForm"):a.error("Can't find MultiStepForm instance"))}}(jQuery);